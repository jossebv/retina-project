<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Retina: recepci贸n y transmisi贸n de infrarrojos: common/include/fsm_retina_v2.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Retina: recepci贸n y transmisi贸n de infrarrojos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('fsm__retina__v2_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">fsm_retina_v2.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Header for <a class="el" href="fsm__retina__v2_8c.html" title="Retina FSM main file.">fsm_retina_v2.c</a> file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;<a class="el" href="fsm_8h_source.html">fsm.h</a>&quot;</code><br />
<code>#include &quot;port_lcd.h&quot;</code><br />
</div>
<p><a href="fsm__retina__v2_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a90476b2dfdca168581ddcdb4e3fc55fb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__retina__v2_8h.html#a90476b2dfdca168581ddcdb4e3fc55fb">NUMBER_BUTTONS</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a90476b2dfdca168581ddcdb4e3fc55fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af696a770290a5515af3c4edd43e98d4e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__retina__v2_8h.html#af696a770290a5515af3c4edd43e98d4e">NUMBER_CONTROLLERS</a>&#160;&#160;&#160;5</td></tr>
<tr class="separator:af696a770290a5515af3c4edd43e98d4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99c1ca560fbc11cbde3486d9761c0e69"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__retina__v2_8h.html#a99c1ca560fbc11cbde3486d9761c0e69">CONTROLLERS_INITIALLY_AV</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a99c1ca560fbc11cbde3486d9761c0e69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20004e90fe8f26300e72e57dc2599db7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__retina__v2_8h.html#a20004e90fe8f26300e72e57dc2599db7">BUTTON_0_ID</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a20004e90fe8f26300e72e57dc2599db7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a96932c1fcd674f9ee10006e095bbf917"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__retina__v2_8h.html#a96932c1fcd674f9ee10006e095bbf917">fsm_retina_new_v2</a> (<a class="el" href="structfsm__t.html">fsm_t</a> *button_arr[], uint32_t button_press_time, <a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_tx, <a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_rx, uint8_t rgb_id)</td></tr>
<tr class="memdesc:a96932c1fcd674f9ee10006e095bbf917"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new RETINA FSM.  <br /></td></tr>
<tr class="separator:a96932c1fcd674f9ee10006e095bbf917"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc1413fa320f2c6089db6d2419a960fb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__retina__v2_8h.html#adc1413fa320f2c6089db6d2419a960fb">fsm_retina_init_v2</a> (<a class="el" href="structfsm__t.html">fsm_t</a> *p_this, <a class="el" href="structfsm__t.html">fsm_t</a> *button_arr[], uint32_t button_press_time_ms, <a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_tx, <a class="el" href="structfsm__t.html">fsm_t</a> *p_fsm_rx, uint8_t rgb_id)</td></tr>
<tr class="memdesc:adc1413fa320f2c6089db6d2419a960fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the infrared transmitter FSM.  <br /></td></tr>
<tr class="separator:adc1413fa320f2c6089db6d2419a960fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header for <a class="el" href="fsm__retina__v2_8c.html" title="Retina FSM main file.">fsm_retina_v2.c</a> file. </p>
<dl class="section author"><dt>Author</dt><dd>Jose Manuel Bravo Pacheco </dd>
<dd>
Victor Garcia Garcia </dd></dl>
<dl class="section date"><dt>Date</dt><dd>22/02/2023 </dd></dl>

<p class="definition">Definition in file <a class="el" href="fsm__retina__v2_8h_source.html">fsm_retina_v2.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a20004e90fe8f26300e72e57dc2599db7" name="a20004e90fe8f26300e72e57dc2599db7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20004e90fe8f26300e72e57dc2599db7">&#9670;&#160;</a></span>BUTTON_0_ID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUTTON_0_ID&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Identification for button 0 </p>

<p class="definition">Definition at line <a class="el" href="fsm__retina__v2_8h_source.html#l00028">28</a> of file <a class="el" href="fsm__retina__v2_8h_source.html">fsm_retina_v2.h</a>.</p>

</div>
</div>
<a id="a99c1ca560fbc11cbde3486d9761c0e69" name="a99c1ca560fbc11cbde3486d9761c0e69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99c1ca560fbc11cbde3486d9761c0e69">&#9670;&#160;</a></span>CONTROLLERS_INITIALLY_AV</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONTROLLERS_INITIALLY_AV&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Number controllers initially available </p>

<p class="definition">Definition at line <a class="el" href="fsm__retina__v2_8h_source.html#l00026">26</a> of file <a class="el" href="fsm__retina__v2_8h_source.html">fsm_retina_v2.h</a>.</p>

</div>
</div>
<a id="a90476b2dfdca168581ddcdb4e3fc55fb" name="a90476b2dfdca168581ddcdb4e3fc55fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90476b2dfdca168581ddcdb4e3fc55fb">&#9670;&#160;</a></span>NUMBER_BUTTONS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUMBER_BUTTONS&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Number of buttons of the controller (3 min: on_button, change_button, and generic button) </p>

<p class="definition">Definition at line <a class="el" href="fsm__retina__v2_8h_source.html#l00024">24</a> of file <a class="el" href="fsm__retina__v2_8h_source.html">fsm_retina_v2.h</a>.</p>

</div>
</div>
<a id="af696a770290a5515af3c4edd43e98d4e" name="af696a770290a5515af3c4edd43e98d4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af696a770290a5515af3c4edd43e98d4e">&#9670;&#160;</a></span>NUMBER_CONTROLLERS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUMBER_CONTROLLERS&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Number of controllers to store </p>

<p class="definition">Definition at line <a class="el" href="fsm__retina__v2_8h_source.html#l00025">25</a> of file <a class="el" href="fsm__retina__v2_8h_source.html">fsm_retina_v2.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="adc1413fa320f2c6089db6d2419a960fb" name="adc1413fa320f2c6089db6d2419a960fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc1413fa320f2c6089db6d2419a960fb">&#9670;&#160;</a></span>fsm_retina_init_v2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fsm_retina_init_v2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_this</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>button_arr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>button_press_time_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_rx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rgb_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the infrared transmitter FSM. </p>
<p>This function initializes the default values of the FSM struct. On the basic version of Retina, it does not have HW (such as status LEDs, as in example); in thtat case, this fuction must call to the port to initialize the HW associated</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <a class="el" href="structfsm__t.html" title="Structure that defines a state machine.">fsm_t</a> struct that contains an <a class="el" href="structfsm__retina__t.html" title="Structure to define the Retina FSM.">fsm_retina_t</a>. </td></tr>
    <tr><td class="paramname">button_arr</td><td>Pointer to an array with pointers to <a class="el" href="structfsm__button__t.html" title="Struct to define the FSM of a button.">fsm_button_t</a> structs. </td></tr>
    <tr><td class="paramname">button_press_time_ms</td><td>Duration in ms of the button press to change between transmitter and receiver modes. </td></tr>
    <tr><td class="paramname">p_fsm_tx</td><td>Pointer to an <a class="el" href="structfsm__t.html" title="Structure that defines a state machine.">fsm_t</a> struct that contains an <a class="el" href="structfsm__tx__t.html" title="Struct to define the TX FSM.">fsm_tx_t</a>. </td></tr>
    <tr><td class="paramname">p_fsm_rx</td><td>Pointer to an fsm-t struct that contains an <a class="el" href="structfsm__rx__t.html" title="Struct to define the RX FSM.">fsm_rx_t</a>. </td></tr>
    <tr><td class="paramname">rgb_id</td><td>Identifier number of the board rgb. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="fsm__retina__v2_8c_source.html#l00459">459</a> of file <a class="el" href="fsm__retina__v2_8c_source.html">fsm_retina_v2.c</a>.</p>

</div>
</div>
<a id="a96932c1fcd674f9ee10006e095bbf917" name="a96932c1fcd674f9ee10006e095bbf917"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96932c1fcd674f9ee10006e095bbf917">&#9670;&#160;</a></span>fsm_retina_new_v2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfsm__t.html">fsm_t</a> * fsm_retina_new_v2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>button_arr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>button_press_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsm__t.html">fsm_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_rx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rgb_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new RETINA FSM. </p>
<p>This FSM is the mains state machine of the Retina system that governs the interaction between the otrher state machines of the system: button, trasmitter ans receiver FSM.</p>
<p>-The FSM starts in the WAIT RX state and checks if the button has been pressed for more than button_press_time_ms ms. If so, it goes to the WAIT_TX state to wait to transmit. -When in the WAIT TX state, it checks if the button has been pressed for more than button_press_time_ms ms. If so, it goes to the WAIT RX state to wait to receive. -Being in WAIT RX or WAIT TX, if no machine has any activity (neither the button's FSM, nor the transmitter's, nor the receiver's), it goes to low power mode SLEEP RX or SLEEP TX, respectively. -While in SLEEP RX or SLEEP TX, it checks that no machine has activity, and, by means of an autotransition, it goes to sleep. These autotransitions are used to avoid staying awake by any interruption from other elements than ours, or the debugger. -When waking up by one of our system elements, being in SLEEP RX or SLEEP TX, it will always switch (check_true()) to WAIT RX or WAIT TX, respectively.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">button_arr</td><td>Array with the pointers to <a class="el" href="structfsm__button__t.html" title="Struct to define the FSM of a button.">fsm_button_t</a> structs. </td></tr>
    <tr><td class="paramname">button_press_time</td><td>Duration in ms of the button press to change between transmitter and receiver modes. </td></tr>
    <tr><td class="paramname">p_fsm_tx</td><td>Pointer to an <a class="el" href="structfsm__t.html" title="Structure that defines a state machine.">fsm_t</a> struct that contains an <a class="el" href="structfsm__tx__t.html" title="Struct to define the TX FSM.">fsm_tx_t</a>. </td></tr>
    <tr><td class="paramname">p_fsm_rx</td><td>Pointer to an <a class="el" href="structfsm__t.html" title="Structure that defines a state machine.">fsm_t</a> struct that contains an <a class="el" href="structfsm__rx__t.html" title="Struct to define the RX FSM.">fsm_rx_t</a>. </td></tr>
    <tr><td class="paramname">rgb_id</td><td>Identifier number of the board rgb. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>fsm_t* </dd></dl>

<p class="definition">Definition at line <a class="el" href="fsm__retina__v2_8c_source.html#l00452">452</a> of file <a class="el" href="fsm__retina__v2_8c_source.html">fsm_retina_v2.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_bdd9a5d540de89e9fe90efdfc6973a4f.html">common</a></li><li class="navelem"><a class="el" href="dir_11fbc4217d50ab21044e5ad6614aede5.html">include</a></li><li class="navelem"><a class="el" href="fsm__retina__v2_8h.html">fsm_retina_v2.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
